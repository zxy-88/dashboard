<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        /* Chart Container Styles */
        .chart-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            display: none;
        }

        .chart-card.visible {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .chart-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-title svg {
            width: 24px;
            height: 24px;
            stroke: var(--primary-light);
        }

        .chart-stats {
            display: flex;
            gap: 1rem;
        }

        .stat-badge {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(168, 85, 247, 0.2));
            border: 1px solid rgba(99, 102, 241, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .stat-badge strong {
            color: var(--primary-light);
            font-weight: 600;
        }

        .chart-wrapper {
            position: relative;
            min-height: 350px;
            width: 100%;
        }

        @media (max-width: 768px) {
            .chart-wrapper {
                height: 280px;
            }

            .chart-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .chart-stats {
                flex-wrap: wrap;
            }
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #475569;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
        }

        /* Light Theme */
        body.light-theme {
            --bg-dark: #f1f5f9;
            --bg-card: #ffffff;
            --bg-input: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #cbd5e1;
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 50%, #e2e8f0 100%);
        }

        body.light-theme .header h1 {
            background: linear-gradient(135deg, #4f46e5, #6366f1, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Light theme chart label fix */
        body.light-theme .chart-card {
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.15);
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            border-color: var(--primary);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            stroke: var(--text-primary);
            transition: transform 0.3s ease;
        }

        .theme-toggle:hover svg {
            transform: rotate(15deg);
        }

        .theme-toggle .icon-sun,
        .theme-toggle .icon-moon {
            position: absolute;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .theme-toggle .icon-sun {
            opacity: 0;
            transform: rotate(-90deg);
        }

        .theme-toggle .icon-moon {
            opacity: 1;
            transform: rotate(0deg);
        }

        body.light-theme .theme-toggle .icon-sun {
            opacity: 1;
            transform: rotate(0deg);
        }

        body.light-theme .theme-toggle .icon-moon {
            opacity: 0;
            transform: rotate(90deg);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light), var(--primary), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .filter-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group label svg {
            width: 18px;
            height: 18px;
            stroke: var(--primary-light);
        }

        .form-group input[type="date"] {
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-input);
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Prompt', sans-serif;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .form-group input[type="date"]:hover {
            border-color: var(--primary-light);
        }

        .form-group input[type="date"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .form-group input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        .btn-fetch {
            padding: 0.875rem 2rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            font-family: 'Prompt', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-height: 52px;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-fetch:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
        }

        .btn-fetch:active {
            transform: translateY(0);
        }

        .btn-fetch:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-fetch svg {
            width: 20px;
            height: 20px;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .status-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .status-text {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-secondary);
        }

        .status-text.loading {
            color: var(--warning);
        }

        .status-text.success {
            color: var(--success);
        }

        .status-text.error {
            color: var(--error);
        }

        .record-count {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .table-container {
            background: var(--bg-card);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }

        tbody tr:nth-child(even):hover {
            background: rgba(99, 102, 241, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            stroke: var(--border-color);
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--error);
            display: none;
        }

        /* Custom scrollbar */
        .table-wrapper::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .table-wrapper::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Search Box Styles */
        .search-container {
            padding: 1rem 1.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 250px;
            max-width: 400px;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.75rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg-input);
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: 'Prompt', sans-serif;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }

        .search-box input::placeholder {
            color: var(--text-secondary);
        }

        .search-box svg {
            position: absolute;
            left: 0.875rem;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            stroke: var(--text-secondary);
            pointer-events: none;
        }

        .search-info {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .search-info strong {
            color: var(--primary-light);
        }

        /* Sortable Table Headers */
        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 1.5rem;
        }

        th.sortable::after {
            content: '‚áÖ';
            position: absolute;
            right: 0.5rem;
            opacity: 0.4;
            font-size: 0.8rem;
        }

        th.sortable.asc::after {
            content: '‚Üë';
            opacity: 1;
            color: #10b981;
        }

        th.sortable.desc::after {
            content: '‚Üì';
            opacity: 1;
            color: #f59e0b;
        }

        /* No results message */
        .no-results {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .no-results svg {
            width: 48px;
            height: 48px;
            stroke: var(--border-color);
            margin-bottom: 0.5rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .filter-card {
                padding: 1.5rem;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }

            .status-bar {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</head>

<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()" title="‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏° ‡∏™‡∏ß‡πà‡∏≤‡∏á/‡∏°‡∏∑‡∏î">
        <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
    </button>

    <div class="container">
        <div class="header">
            <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h1>
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
        </div>

        <div class="filter-card">
            <div class="filter-grid">
                <div class="form-group">
                    <label>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    </label>
                    <input type="date" id="startDate" value="2025-12-05">
                </div>

                <div class="form-group">
                    <label>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
                    </label>
                    <input type="date" id="endDate" value="2025-12-05">
                </div>

                <button class="btn-fetch" id="fetchBtn" onclick="fetchData()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        id="fetchIcon">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    <span id="fetchText">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                </button>
            </div>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="status-bar" id="statusBar" style="display: none;">
            <div class="status-text" id="statusText">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20"
                    height="20">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span></span>
            </div>
            <div class="record-count" id="recordCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
        </div>

        <!-- Chart Section -->
        <div class="chart-card" id="chartCard">
            <div class="chart-header">
                <div class="chart-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (stt_desc) ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                </div>
                <div class="chart-stats">
                    <div class="stat-badge">
                        üë• ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: <strong id="totalCheckers">0</strong> ‡∏Ñ‡∏ô
                    </div>
                    <div class="stat-badge">
                        üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong id="totalJobs">0</strong> ‡∏á‡∏≤‡∏ô
                    </div>
                    <div class="stat-badge">
                        üè∑Ô∏è ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô: <strong id="totalTypes">0</strong> ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="checkbynameChart"></canvas>
            </div>
            <div id="chartLegend"
                style="margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.75rem; justify-content: center;"></div>
        </div>

        <!-- Chart 2: CLAIM_NO Distribution by EMCSSTATUS -->
        <div class="chart-card" id="chartCard2">
            <div class="chart-header">
                <div class="chart-title">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏á‡∏≤‡∏ô "‡∏à‡∏ö‡∏á‡∏≤‡∏ô" ‡∏ï‡∏≤‡∏°‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ CLAIM_NO ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ EMCSSTATUS
                </div>
                <div class="chart-stats">
                    <div class="stat-badge">
                        ‚úîÔ∏è ‡∏á‡∏≤‡∏ô‡∏à‡∏ö‡∏á‡∏≤‡∏ô: <strong id="totalFinishedJobs">0</strong> ‡∏á‡∏≤‡∏ô
                    </div>
                    <div class="stat-badge">
                        ÔøΩ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: <strong id="totalAssignees">0</strong> ‡∏Ñ‡∏ô
                    </div>
                    <div class="stat-badge">
                        ‚úÖ Send: <strong id="totalSend">0</strong> ‡∏á‡∏≤‡∏ô
                    </div>
                    <div class="stat-badge">
                        ‚è≥ Unsend: <strong id="totalUnsend">0</strong> ‡∏á‡∏≤‡∏ô
                    </div>
                </div>
            </div>
            <div class="chart-wrapper" id="chartWrapper2" style="min-height: 350px;">
                <canvas id="claimNoChart"></canvas>
            </div>
        </div>

        <div class="table-container" id="tableContainer" style="display: none;">
            <div class="search-container">
                <div class="search-box">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... (‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)"
                        oninput="filterTable()">
                </div>
                <div class="search-info">
                    ‡πÅ‡∏™‡∏î‡∏á <strong id="filteredCount">0</strong> ‡∏à‡∏≤‡∏Å <strong id="totalCount">0</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </div>
            </div>
            <div class="table-wrapper">
                <table id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="empty-state" id="emptyState">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"</p>
        </div>
    </div>

    <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ò‡∏µ‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        function isLightTheme() {
            return document.body.classList.contains('light-theme');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö chart labels ‡∏ï‡∏≤‡∏°‡∏ò‡∏µ‡∏°
        function getChartLabelColor() {
            return isLightTheme() ? '#1e293b' : '#f1f5f9';
        }

        function getChartSecondaryColor() {
            return isLightTheme() ? '#64748b' : '#94a3b8';
        }

        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö re-render ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°
        let lastChartData = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏°
        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            const isLight = document.body.classList.contains('light-theme');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');

            // Re-render ‡∏Å‡∏£‡∏≤‡∏ü‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (lastChartData && lastChartData.length > 0) {
                renderCheckbynameChart(lastChartData);
                renderClaimNoChart(lastChartData);
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏ò‡∏µ‡∏°‡∏à‡∏≤‡∏Å localStorage ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        (function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
            }
        })();

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        async function fetchData() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const fetchBtn = document.getElementById('fetchBtn');
            const fetchIcon = document.getElementById('fetchIcon');
            const fetchText = document.getElementById('fetchText');
            const errorMessage = document.getElementById('errorMessage');
            const statusBar = document.getElementById('statusBar');
            const statusText = document.getElementById('statusText');
            const tableContainer = document.getElementById('tableContainer');
            const emptyState = document.getElementById('emptyState');

            // Validate dates
            if (!startDate || !endDate) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î');
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                showError('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î');
                return;
            }

            // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            const startParts = startDate.split('-');
            const endParts = endDate.split('-');

            const sd = startParts[2]; // day
            const sm = startParts[1]; // month
            const sy = startParts[0]; // year

            const ed = endParts[2];
            const em = endParts[1];
            const ey = endParts[0];

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL (‡∏ú‡πà‡∏≤‡∏ô Flask server)
            const url = `/api/fetch-data?start_date=${startDate}&end_date=${endDate}`;

            // Show loading state
            fetchBtn.disabled = true;
            fetchText.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
            fetchIcon.innerHTML = '<circle class="spinner" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="30 70" />';
            fetchIcon.classList.add('spinner');

            hideError();
            statusBar.style.display = 'flex';
            statusText.className = 'status-text loading';
            statusText.innerHTML = `
                <svg class="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="30 70" />
                </svg>
                <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
            `;

            try {
                const response = await fetch(url);
                const result = await response.json();

                // Check for error from server
                if (result.error) {
                    throw new Error(result.error);
                }

                const arrData = result.data || [];

                if (arrData.length === 0) {
                    emptyState.style.display = 'block';
                    tableContainer.style.display = 'none';
                    document.getElementById('chartCard').classList.remove('visible');
                    document.getElementById('chartCard2').classList.remove('visible');
                    statusText.className = 'status-text';
                    statusText.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
                    `;
                    document.getElementById('recordCount').textContent = '0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£';
                } else {
                    // Save data for re-render when theme changes
                    lastChartData = arrData;

                    // Render charts and table
                    renderCheckbynameChart(arrData);
                    renderClaimNoChart(arrData);
                    renderTable(arrData);

                    emptyState.style.display = 'none';
                    tableContainer.style.display = 'block';
                    statusText.className = 'status-text success';
                    statusText.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${startDate} ‡∏ñ‡∏∂‡∏á ${endDate})</span>
                    `;
                    document.getElementById('recordCount').textContent = `${arrData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                }

            } catch (error) {
                console.error('Error:', error);
                showError(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`);
                statusText.className = 'status-text error';
                statusText.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                `;
            } finally {
                // Reset button
                fetchBtn.disabled = false;
                fetchText.textContent = '‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                fetchIcon.classList.remove('spinner');
                fetchIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />';
            }
        }

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter ‡πÅ‡∏•‡∏∞ sort
        let tableData = [];
        let tableColumns = [];
        let currentSortColumn = null;
        let currentSortDirection = 'asc';

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á (DataFrame-like display)
        function renderTable(data) {
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tableBody');

            // Clear previous data
            thead.innerHTML = '';
            tbody.innerHTML = '';

            if (data.length === 0) return;

            // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter ‡πÅ‡∏•‡∏∞ sort
            tableData = [...data];

            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏≥‡∏î‡∏±‡∏ö
            const desiredColumns = [
                'claim_no',
                'notify_no',
                'survey_no',
                'empcode',
                'checkByName',
                'checker_dt',
                'stt_desc',
                'EMCSby',
                'EMCSdate',
                'EMCSstatus'
            ];

            // ‡∏´‡∏≤ field ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô data (case-insensitive matching)
            const availableFields = Object.keys(data[0]);
            tableColumns = desiredColumns.map(col => {
                const found = availableFields.find(f => f.toLowerCase() === col.toLowerCase());
                return found || col;
            });

            // Reset sort state
            currentSortColumn = null;
            currentSortDirection = 'asc';

            // Create header row with sortable columns
            createTableHeader();

            // Render data rows
            renderTableRows(tableData);

            // Update counts
            updateSearchCounts(tableData.length, tableData.length);

            // Clear search input
            document.getElementById('searchInput').value = '';
        }

        // Mapping ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        const columnDisplayNames = {
            'claim_no': '‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ñ‡∏•‡∏°',
            'notify_no': '‡πÄ‡∏•‡∏Ç‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á',
            'survey_no': '‡πÄ‡∏•‡∏Ç‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏ß‡∏¢‡πå',
            'empcode': '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏£‡∏ß‡∏à',
            'checkbyname': '‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',
            'checker_dt': '‡∏ß‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',
            'stt_desc': '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô',
            'emcsby': '‡∏ú‡∏π‡πâ‡∏Ñ‡∏µ‡∏¢‡πå',
            'emcsdate': '‡∏ß‡∏±‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå',
            'emcsstatus': '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå'
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        function getColumnDisplayName(colName) {
            const lowerName = colName.toLowerCase();
            return columnDisplayNames[lowerName] || colName;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á header row ‡∏û‡∏£‡πâ‡∏≠‡∏° sortable
        function createTableHeader() {
            const thead = document.getElementById('tableHead');
            thead.innerHTML = '';

            const headerRow = document.createElement('tr');

            // Add index column (not sortable)
            const indexTh = document.createElement('th');
            indexTh.textContent = '#';
            headerRow.appendChild(indexTh);

            tableColumns.forEach((col, colIndex) => {
                const th = document.createElement('th');
                th.textContent = getColumnDisplayName(col);
                th.className = 'sortable';
                th.dataset.column = col;
                th.dataset.index = colIndex;
                th.onclick = () => sortTable(col);

                // Add sort indicator if this is the current sort column
                if (currentSortColumn === col) {
                    th.classList.add(currentSortDirection);
                }

                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
        }

        // Render table rows
        function renderTableRows(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td colspan="${tableColumns.length + 1}" class="no-results">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                    </td>
                `;
                tbody.appendChild(tr);
                return;
            }

            data.forEach((row, index) => {
                const tr = document.createElement('tr');

                // Add index cell
                const indexTd = document.createElement('td');
                indexTd.textContent = index + 1;
                indexTd.style.fontWeight = '600';
                indexTd.style.color = 'var(--primary-light)';
                tr.appendChild(indexTd);

                tableColumns.forEach(col => {
                    const td = document.createElement('td');
                    const value = row[col];
                    td.textContent = value !== null && value !== undefined ? value : '-';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (filter)
        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();

            if (searchTerm === '') {
                // If no search term, show all data
                renderTableRows(tableData);
                updateSearchCounts(tableData.length, tableData.length);
                return;
            }

            // Filter data across all columns
            const filteredData = tableData.filter(row => {
                return tableColumns.some(col => {
                    const value = row[col];
                    if (value === null || value === undefined) return false;
                    return value.toString().toLowerCase().includes(searchTerm);
                });
            });

            // Re-render with filtered data
            renderTableRows(filteredData);
            updateSearchCounts(filteredData.length, tableData.length);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô sort
        function sortTable(column) {
            // Toggle direction if same column, else reset to asc
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }

            // Sort the data
            tableData.sort((a, b) => {
                let valA = a[column];
                let valB = b[column];

                // Handle null/undefined
                if (valA === null || valA === undefined) valA = '';
                if (valB === null || valB === undefined) valB = '';

                // Convert to string for comparison
                valA = valA.toString().toLowerCase();
                valB = valB.toString().toLowerCase();

                // Try numeric comparison if both are numbers
                const numA = parseFloat(valA);
                const numB = parseFloat(valB);
                if (!isNaN(numA) && !isNaN(numB)) {
                    return currentSortDirection === 'asc' ? numA - numB : numB - numA;
                }

                // String comparison
                if (valA < valB) return currentSortDirection === 'asc' ? -1 : 1;
                if (valA > valB) return currentSortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            // Re-render table
            createTableHeader();
            filterTable(); // Re-apply any active filter
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        function updateSearchCounts(filtered, total) {
            document.getElementById('filteredCount').textContent = filtered;
            document.getElementById('totalCount').textContent = total;
        }

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö chart instance
        let checkbynameChartInstance = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü checkbyname ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏° stt_desc (Stacked Bar Chart)
        function renderCheckbynameChart(data) {
            const chartCard = document.getElementById('chartCard');
            const canvas = document.getElementById('checkbynameChart');
            const ctx = canvas.getContext('2d');

            // Debug: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
            console.log('üìä Total data rows:', data.length);
            if (data.length > 0) {
                console.log('üìã Sample data (first row):', data[0]);
                console.log('üîë Available fields:', Object.keys(data[0]));
            }

            // ‡∏´‡∏≤ field ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö checkbyname ‡πÅ‡∏•‡∏∞ stt_desc (case-insensitive)
            let checkbynameField = null;
            let sttDescField = null;
            if (data.length > 0) {
                const fields = Object.keys(data[0]);
                checkbynameField = fields.find(f => f.toLowerCase() === 'checkbyname');
                sttDescField = fields.find(f => f.toLowerCase() === 'stt_desc');
                console.log('üîç Found checkbyname field:', checkbynameField);
                console.log('üîç Found stt_desc field:', sttDescField);
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á nested counts: { name: { stt_desc: count } }
            const nestedCounts = {};
            const allSttDescs = new Set();

            data.forEach(row => {
                let name = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                let sttDesc = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó';

                if (checkbynameField && row[checkbynameField]) {
                    name = row[checkbynameField];
                }
                if (sttDescField && row[sttDescField]) {
                    sttDesc = row[sttDescField];
                }

                allSttDescs.add(sttDesc);

                if (!nestedCounts[name]) {
                    nestedCounts[name] = {};
                }
                nestedCounts[name][sttDesc] = (nestedCounts[name][sttDesc] || 0) + 1;
            });

            console.log('üìà Nested counts:', nestedCounts);
            console.log('üè∑Ô∏è All stt_desc types:', Array.from(allSttDescs));

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
            const totals = {};
            Object.keys(nestedCounts).forEach(name => {
                totals[name] = Object.values(nestedCounts[name]).reduce((a, b) => a + b, 0);
            });

            const sortedNames = Object.keys(totals).sort((a, b) => totals[b] - totals[a]);
            const sttDescArray = Array.from(allSttDescs).sort();

            console.log('‚úÖ Sorted names:', sortedNames);
            console.log('‚úÖ stt_desc types:', sttDescArray);

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó stats
            document.getElementById('totalCheckers').textContent = sortedNames.length;
            document.getElementById('totalJobs').textContent = data.length;
            document.getElementById('totalTypes').textContent = sttDescArray.length;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ stt_desc
            const colorPalette = [
                { bg: 'rgba(99, 102, 241, 0.85)', border: 'rgba(99, 102, 241, 1)' },     // Indigo
                { bg: 'rgba(16, 185, 129, 0.85)', border: 'rgba(16, 185, 129, 1)' },     // Emerald
                { bg: 'rgba(245, 158, 11, 0.85)', border: 'rgba(245, 158, 11, 1)' },     // Amber
                { bg: 'rgba(239, 68, 68, 0.85)', border: 'rgba(239, 68, 68, 1)' },       // Red
                { bg: 'rgba(168, 85, 247, 0.85)', border: 'rgba(168, 85, 247, 1)' },     // Purple
                { bg: 'rgba(236, 72, 153, 0.85)', border: 'rgba(236, 72, 153, 1)' },     // Pink
                { bg: 'rgba(14, 165, 233, 0.85)', border: 'rgba(14, 165, 233, 1)' },     // Sky
                { bg: 'rgba(132, 204, 22, 0.85)', border: 'rgba(132, 204, 22, 1)' },     // Lime
                { bg: 'rgba(251, 146, 60, 0.85)', border: 'rgba(251, 146, 60, 1)' },     // Orange
                { bg: 'rgba(34, 211, 238, 0.85)', border: 'rgba(34, 211, 238, 1)' },     // Cyan
                { bg: 'rgba(244, 114, 182, 0.85)', border: 'rgba(244, 114, 182, 1)' },   // Rose
                { bg: 'rgba(74, 222, 128, 0.85)', border: 'rgba(74, 222, 128, 1)' },     // Green
            ];

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á datasets ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ stt_desc
            const datasets = sttDescArray.map((sttDesc, index) => {
                const colorIndex = index % colorPalette.length;
                const dataValues = sortedNames.map(name => {
                    return nestedCounts[name][sttDesc] || 0;
                });

                return {
                    label: sttDesc,
                    data: dataValues,
                    backgroundColor: colorPalette[colorIndex].bg,
                    borderColor: colorPalette[colorIndex].border,
                    borderWidth: 1,
                    borderRadius: 4,
                    borderSkipped: false
                };
            });

            // ‡∏•‡∏ö chart ‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if (checkbynameChartInstance) {
                checkbynameChartInstance.destroy();
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á chart ‡πÉ‡∏´‡∏°‡πà (Stacked Horizontal Bar Chart)
            checkbynameChartInstance = new Chart(ctx, {
                type: 'bar',
                plugins: [ChartDataLabels],
                data: {
                    labels: sortedNames,
                    datasets: datasets
                },
                options: {
                    indexAxis: 'y', // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: getChartLabelColor(),
                                font: {
                                    family: 'Prompt',
                                    size: 12,
                                    weight: '500'
                                },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'rectRounded'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleFont: {
                                family: 'Prompt',
                                size: 14,
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Prompt',
                                size: 13
                            },
                            padding: 12,
                            cornerRadius: 10,
                            displayColors: true,
                            callbacks: {
                                title: function (context) {
                                    return 'üë§ ' + context[0].label;
                                },
                                label: function (context) {
                                    const name = context.label;
                                    const sttDesc = context.dataset.label;
                                    const value = context.raw;
                                    const total = totals[name];
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${sttDesc}: ${value} ‡∏á‡∏≤‡∏ô (${percentage}%)`;
                                },
                                afterBody: function (context) {
                                    const name = context[0].label;
                                    return [`üìä ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totals[name]} ‡∏á‡∏≤‡∏ô`];
                                }
                            }
                        },
                        // Data labels ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô‡πÅ‡∏ó‡πà‡∏á‡∏Å‡∏£‡∏≤‡∏ü
                        datalabels: {
                            display: function (context) {
                                return context.dataset.data[context.dataIndex] > 0;
                            },
                            color: '#ffffff',
                            anchor: 'center',
                            align: 'center',
                            font: {
                                family: 'Prompt',
                                size: 10,
                                weight: '600'
                            },
                            formatter: function (value) {
                                return value > 0 ? value : '';
                            }
                        }
                    },
                    layout: {
                        padding: {
                            right: 20
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: getChartSecondaryColor(),
                                font: {
                                    family: 'Prompt',
                                    size: 12
                                }
                            },
                            title: {
                                display: true,
                                text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô',
                                color: getChartSecondaryColor(),
                                font: {
                                    family: 'Prompt',
                                    size: 13,
                                    weight: '500'
                                }
                            }
                        },
                        y: {
                            stacked: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: getChartLabelColor(),
                                font: {
                                    family: 'Prompt',
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });

            // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô (50px ‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô, minimum 400px)
            const chartHeight = Math.max(400, sortedNames.length * 50);
            document.querySelector('.chart-wrapper').style.height = chartHeight + 'px';

            // ‡πÅ‡∏™‡∏î‡∏á chart card
            chartCard.classList.add('visible');
        }

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö chart instance ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CLAIM_NO
        let claimNoChartInstance = null;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ CLAIM_NO ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö
        function getAssigneeByClaimNo(claimNo) {
            if (!claimNo || claimNo.toString().trim() === '') {
                return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            }

            const claimNoStr = claimNo.toString().trim();
            const lastDigit = claimNoStr.charAt(claimNoStr.length - 1);

            switch (lastDigit) {
                case '0':
                case '1':
                    return '‡∏ß‡∏£‡∏ô‡∏∏‡∏ä ‡∏ô‡πâ‡∏≥‡∏û‡∏∏';
                case '2':
                case '3':
                    return '‡∏Å‡∏±‡∏¢‡∏ç‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå ‡πÄ‡∏™‡∏ô‡∏î‡∏≥';
                case '4':
                case '5':
                    return '‡∏ß‡∏¥‡∏™‡∏∏‡∏î‡∏≤ ‡∏î‡∏≠‡∏ô‡∏´‡∏°‡∏±‡∏ô';
                case '6':
                case '7':
                    return '‡∏ô‡∏¥‡∏™‡∏≤‡∏Å‡∏£ ‡πÄ‡∏õ‡∏£‡∏°‡∏õ‡∏£‡∏µ‡∏î‡∏¥‡πå';
                case '8':
                case '9':
                    return '‡∏™‡∏∏‡∏ó‡∏¥‡∏©‡∏≤ ‡∏û‡∏á‡∏©‡πå‡πÅ‡∏Ç‡∏Å';
                default:
                    return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü CLAIM_NO Distribution (Stacked Horizontal Bar Chart)
        function renderClaimNoChart(data) {
            const chartCard = document.getElementById('chartCard2');
            const canvas = document.getElementById('claimNoChart');
            const ctx = canvas.getContext('2d');

            // ‡∏´‡∏≤ field ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö CLAIM_NO, EMCSSTATUS, EMCSby ‡πÅ‡∏•‡∏∞ stt_desc (case-insensitive)
            let claimNoField = null;
            let emcsStatusField = null;
            let emcsByField = null;
            let sttDescField = null;
            if (data.length > 0) {
                const fields = Object.keys(data[0]);
                claimNoField = fields.find(f => f.toLowerCase() === 'claim_no');
                emcsStatusField = fields.find(f => f.toLowerCase() === 'emcsstatus');
                emcsByField = fields.find(f => f.toLowerCase() === 'emcsby');
                sttDescField = fields.find(f => f.toLowerCase() === 'stt_desc');
                console.log('üîç Found CLAIM_NO field:', claimNoField);
                console.log('üîç Found EMCSSTATUS field:', emcsStatusField);
                console.log('üîç Found EMCSby field:', emcsByField);
                console.log('üîç Found stt_desc field:', sttDescField);
            }

            // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà stt_desc = "‡∏à‡∏ö‡∏á‡∏≤‡∏ô" ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            const filteredData = data.filter(row => {
                if (sttDescField && row[sttDescField]) {
                    return row[sttDescField].toString().trim() === '‡∏à‡∏ö‡∏á‡∏≤‡∏ô';
                }
                return false;
            });

            console.log('üìä Total data rows:', data.length);
            console.log('üìä Filtered data (‡∏à‡∏ö‡∏á‡∏≤‡∏ô only):', filteredData.length);

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á nested counts: { assignee: { status: count } }
            const nestedCounts = {};
            let totalSend = 0;
            let totalUnsend = 0;

            filteredData.forEach(row => {
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö EMCSSTATUS
                let emcsStatus = '';
                if (emcsStatusField && row[emcsStatusField]) {
                    emcsStatus = row[emcsStatusField].toString().trim().toLowerCase();
                }

                let assignee = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                let status = 'unsend';

                if (emcsStatus === 'send') {
                    // ‡∏ñ‡πâ‡∏≤ EMCSSTATUS = send ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å EMCSby
                    status = 'send';
                    totalSend++;

                    if (emcsByField && row[emcsByField]) {
                        assignee = row[emcsByField].toString().trim();
                        if (assignee === '') {
                            assignee = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                        }
                    }
                } else {
                    // ‡∏ñ‡πâ‡∏≤ EMCSSTATUS ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà send ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢ claim_no
                    status = 'unsend';
                    totalUnsend++;

                    let claimNo = '';
                    if (claimNoField && row[claimNoField]) {
                        claimNo = row[claimNoField].toString().trim();
                    }

                    if (claimNo === '') {
                        assignee = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    } else {
                        assignee = getAssigneeByClaimNo(claimNo);
                    }
                }

                if (!nestedCounts[assignee]) {
                    nestedCounts[assignee] = { send: 0, unsend: 0 };
                }
                nestedCounts[assignee][status]++;
            });

            console.log('üìà Nested counts by assignee and status:', nestedCounts);

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢
            const totals = {};
            Object.keys(nestedCounts).forEach(assignee => {
                totals[assignee] = nestedCounts[assignee].send + nestedCounts[assignee].unsend;
            });

            const sortedAssignees = Object.keys(totals).sort((a, b) => totals[b] - totals[a]);
            const statusArray = ['send', 'unsend'];

            console.log('‚úÖ Sorted assignees:', sortedAssignees);

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó stats
            document.getElementById('totalFinishedJobs').textContent = filteredData.length;
            document.getElementById('totalAssignees').textContent = sortedAssignees.length;
            document.getElementById('totalSend').textContent = totalSend;
            document.getElementById('totalUnsend').textContent = totalUnsend;

            // ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö send ‡πÅ‡∏•‡∏∞ unsend
            const statusColors = {
                send: { bg: 'rgba(16, 185, 129, 0.85)', border: 'rgba(16, 185, 129, 1)' },     // Emerald - send
                unsend: { bg: 'rgba(245, 158, 11, 0.85)', border: 'rgba(245, 158, 11, 1)' }    // Amber - unsend
            };

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á datasets ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö send ‡πÅ‡∏•‡∏∞ unsend
            const datasets = statusArray.map(status => {
                const dataValues = sortedAssignees.map(assignee => {
                    return nestedCounts[assignee][status] || 0;
                });

                return {
                    label: status === 'send' ? '‚úÖ Send' : '‚è≥ Unsend',
                    data: dataValues,
                    backgroundColor: statusColors[status].bg,
                    borderColor: statusColors[status].border,
                    borderWidth: 1,
                    borderRadius: 4,
                    borderSkipped: false
                };
            });

            // ‡∏•‡∏ö chart ‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            if (claimNoChartInstance) {
                claimNoChartInstance.destroy();
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á chart ‡πÉ‡∏´‡∏°‡πà (Stacked Horizontal Bar Chart)
            claimNoChartInstance = new Chart(ctx, {
                type: 'bar',
                plugins: [ChartDataLabels],
                data: {
                    labels: sortedAssignees,
                    datasets: datasets
                },
                options: {
                    indexAxis: 'y', // ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: getChartLabelColor(),
                                font: {
                                    family: 'Prompt',
                                    size: 12,
                                    weight: '500'
                                },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'rectRounded'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleFont: {
                                family: 'Prompt',
                                size: 14,
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'Prompt',
                                size: 13
                            },
                            padding: 12,
                            cornerRadius: 10,
                            displayColors: true,
                            callbacks: {
                                title: function (context) {
                                    const assignee = context[0].label;
                                    let digits = '';
                                    if (assignee === '‡∏ß‡∏£‡∏ô‡∏∏‡∏ä ‡∏ô‡πâ‡∏≥‡∏û‡∏∏') digits = ' (‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢: 0, 1)';
                                    else if (assignee === '‡∏Å‡∏±‡∏¢‡∏ç‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå ‡πÄ‡∏™‡∏ô‡∏î‡∏≥') digits = ' (‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢: 2, 3)';
                                    else if (assignee === '‡∏ß‡∏¥‡∏™‡∏∏‡∏î‡∏≤ ‡∏î‡∏≠‡∏ô‡∏´‡∏°‡∏±‡∏ô') digits = ' (‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢: 4, 5)';
                                    else if (assignee === '‡∏ô‡∏¥‡∏™‡∏≤‡∏Å‡∏£ ‡πÄ‡∏õ‡∏£‡∏°‡∏õ‡∏£‡∏µ‡∏î‡∏¥‡πå') digits = ' (‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢: 6, 7)';
                                    else if (assignee === '‡∏™‡∏∏‡∏ó‡∏¥‡∏©‡∏≤ ‡∏û‡∏á‡∏©‡πå‡πÅ‡∏Ç‡∏Å') digits = ' (‡πÄ‡∏•‡∏Ç‡∏ó‡πâ‡∏≤‡∏¢: 8, 9)';
                                    return 'üë§ ' + assignee + digits;
                                },
                                label: function (context) {
                                    const assignee = context.label;
                                    const status = context.dataset.label;
                                    const value = context.raw;
                                    const total = totals[assignee];
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${status}: ${value} ‡∏á‡∏≤‡∏ô (${percentage}%)`;
                                },
                                afterBody: function (context) {
                                    const assignee = context[0].label;
                                    return [`üìä ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totals[assignee]} ‡∏á‡∏≤‡∏ô`];
                                }
                            }
                        },
                        // Data labels ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ô‡πÅ‡∏ó‡πà‡∏á‡∏Å‡∏£‡∏≤‡∏ü
                        datalabels: {
                            display: function (context) {
                                return context.dataset.data[context.dataIndex] > 0;
                            },
                            color: '#ffffff',
                            anchor: 'center',
                            align: 'center',
                            font: {
                                family: 'Prompt',
                                size: 10,
                                weight: '600'
                            },
                            formatter: function (value) {
                                return value > 0 ? value : '';
                            }
                        }
                    },
                    layout: {
                        padding: {
                            right: 20
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: false
                            },
                            ticks: {
                                color: getChartSecondaryColor(),
                                font: {
                                    family: 'Prompt',
                                    size: 12
                                }
                            },
                            title: {
                                display: true,
                                text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô',
                                color: getChartSecondaryColor(),
                                font: {
                                    family: 'Prompt',
                                    size: 13,
                                    weight: '500'
                                }
                            }
                        },
                        y: {
                            stacked: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: getChartLabelColor(),
                                font: {
                                    family: 'Prompt',
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });

            // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô (50px ‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô, minimum 350px)
            const chartHeight = Math.max(350, sortedAssignees.length * 50);
            document.getElementById('chartWrapper2').style.height = chartHeight + 'px';

            // ‡πÅ‡∏™‡∏î‡∏á chart card
            chartCard.classList.add('visible');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á error
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ã‡πà‡∏≠‡∏ô error
        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        // Set default dates to today
        document.addEventListener('DOMContentLoaded', function () {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
        });
    </script>
</body>

</html>